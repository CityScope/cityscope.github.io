(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{66:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return d}));var a=n(2),i=n(6),r=(n(0),n(84)),o={id:"GAMA"},c={unversionedId:"modules/GAMA",id:"modules/GAMA",isDocsHomePage:!1,title:"GAMA",description:"Agent-Based Model developped in the CityScience group using Gama Platform and integrated in CityScope",source:"@site/docs/modules/GAMA.md",slug:"/modules/GAMA",permalink:"/docs/modules/GAMA",editUrl:"https://github.com/CityScope/cityscope.github.io/blob/new_docsite/docsite/docs/modules/GAMA.md",version:"current",sidebar:"sidebar",previous:{title:"Brix",permalink:"/docs/modules/Brix"},next:{title:"CityIO",permalink:"/docs/backend/CityIO/CityIO"}},l=[{value:"The CityIO global",id:"the-cityio-global",children:[]},{value:"Input",id:"input",children:[]},{value:"Output",id:"output",children:[]},{value:"Basic numeric indicator",id:"basic-numeric-indicator",children:[]}],s={rightToc:l};function d(e){var t=e.components,n=Object(i.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"Agent-Based Model developped in the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.media.mit.edu/groups/city-science/overview/"}),"CityScience")," group using ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://gama-platform.github.io/"}),"Gama Platform")," and integrated in ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.media.mit.edu/projects/cityscope/overview/"}),"CityScope")),Object(r.b)("h1",{id:"tutorial"},"Tutorial"),Object(r.b)("p",null,"If you don\u2019t have a specific table, you can create one ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://cityscope.media.mit.edu/CS_cityscopeJS/"}),"here"),". For this tutorial, we crated one called ",Object(r.b)("inlineCode",{parentName:"p"},"dungeonmaster"),". In this tutorial we will see how to load a table in GAMA, instantiate a Grid, run an hello world simulation and send results back. "),Object(r.b)("p",null,"The first step is to add the import from the ",Object(r.b)("inlineCode",{parentName:"p"},"GAMABrix.gaml")," file. Right after declaring your model, import the necessary species and functions by running:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),'import "GAMABrix.gaml"\n')),Object(r.b)("p",null,"This will add to ",Object(r.b)("inlineCode",{parentName:"p"},"global")," the necessary functions to communicate with ",Object(r.b)("inlineCode",{parentName:"p"},"CityIO")," and three very important species that you will use to give your agents the properties they need to also live in CityIO: ",Object(r.b)("inlineCode",{parentName:"p"},"cityio_numeric_indicator"),", ",Object(r.b)("inlineCode",{parentName:"p"},"cityio_heatmap_indicator"),", and ",Object(r.b)("inlineCode",{parentName:"p"},"cityio_agent"),"."),Object(r.b)("p",null,"Think of ",Object(r.b)("inlineCode",{parentName:"p"},"cityio_numeric_indicator")," and ",Object(r.b)("inlineCode",{parentName:"p"},"cityio_heatmap_indicator")," as two observers in your model that will report information back to CityIO. Later, we'll talk about how to create sub-species of these two species and how to create agents. ",Object(r.b)("inlineCode",{parentName:"p"},"cityio_agent")," is used as the parent class of any species that you want to visualize in CityIO. There are some specific parameters your sub-species needs to define, and we'll talk about them later."),Object(r.b)("h2",{id:"the-cityio-global"},"The CityIO global"),Object(r.b)("p",null,"To connect your world to a table you need to declare the table name inside your ",Object(r.b)("inlineCode",{parentName:"p"},"global"),". For example, we named our table ",Object(r.b)("inlineCode",{parentName:"p"},"dungeonmaster"),":"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),'string city_io_table<-"dungeonmaster";\n')),Object(r.b)("p",null,"While you are building your model, we recommend turning ",Object(r.b)("inlineCode",{parentName:"p"},"GAMABrix")," off speed up the process (the default). By setting ",Object(r.b)("inlineCode",{parentName:"p"},"post_on<-false"),", the model will only update your local grid without posting any of the indicators to cityio. This will reduce your bandwidth usage and allow you to debug your model faster. "),Object(r.b)("p",null,"Once you are done and want to deploy, change:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"bool post_on<-true;\n")),Object(r.b)("h2",{id:"input"},"Input"),Object(r.b)("p",null,"What is geogrid_data? Every time we create a CityScope table, we define a regularly spaced grid which is overlaid on the city district we\u2019re modelling. These grid cells are the basic unit of analysis for the CityScope modules. Every grid cell has properties such as the ",Object(r.b)("inlineCode",{parentName:"p"},"Type")," which represents the land use and ",Object(r.b)("inlineCode",{parentName:"p"},"Height")," which represents the number of floors. These data are dynamic and are updated each time a user interacts with the CityScope table, experimenting with the spatial organisation of land uses and infrastructure. These dynamic data are stored the variable ",Object(r.b)("inlineCode",{parentName:"p"},"geogrid_data"),". This is a list of ojects: one for each grid cell in the CityScope table. "),Object(r.b)("p",null,"In GAMA, the user does not need to be aware of ",Object(r.b)("inlineCode",{parentName:"p"},"geogrid_data"),". The ",Object(r.b)("inlineCode",{parentName:"p"},"udpateGrid")," action should make sure that the state of the simulated world matches the state of the table, and then the user just interacts with the simulated world. All the indicators are then a funcion of the local GAMA world, and not a direct function of ",Object(r.b)("inlineCode",{parentName:"p"},"geogrid_data"),". "),Object(r.b)("p",null,"The user will eventually interact with the ",Object(r.b)("inlineCode",{parentName:"p"},"block")," species. "),Object(r.b)("h2",{id:"output"},"Output"),Object(r.b)("h2",{id:"basic-numeric-indicator"},"Basic numeric indicator"),Object(r.b)("p",null,"In GAMA, indicators are defined as agents from an indicator species. The species for numeric indicators is called ",Object(r.b)("inlineCode",{parentName:"p"},"cityio_numeric_indicator"),". There are two ways of creating a numeric indicator. "),Object(r.b)("p",null,"First, for simple calculations, you can create an agent of the ",Object(r.b)("inlineCode",{parentName:"p"},"cityio_numeric_indicator")," species and pass it the formula to be evaluated as:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),'create cityio_numeric_indicator with: (viz_type:"bar",indicator_name: "Max Height", indicator_value: "max(block collect each.height)");\n')),Object(r.b)("p",null,"This line of code creates a numeric indicator, called ",Object(r.b)("inlineCode",{parentName:"p"},"Max height"),", to be displayed as a ",Object(r.b)("inlineCode",{parentName:"p"},"bar"),", and that performs the calculation ",Object(r.b)("inlineCode",{parentName:"p"},"max(block collect each.height)"),", which gets the maximum height of all blocks. "),Object(r.b)("p",null,"Second, for more complex indicators it might make sense for the user to define its own species. This is done by creating a sub-species of the ",Object(r.b)("inlineCode",{parentName:"p"},"cityio_numeric_indicator")," species. The sub-species needs to define a ",Object(r.b)("inlineCode",{parentName:"p"},"return_indicator")," function that should return a ",Object(r.b)("inlineCode",{parentName:"p"},"float"),". The following example implements the same indicator as above:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"species my_cool_indicator parent: cityio_numeric_indicator {\n    float return_indicator {\n        return max(block collect each.height);\n    }\n}\n")),Object(r.b)("p",null,"and in the ",Object(r.b)("inlineCode",{parentName:"p"},"global init"),"  the useer creates:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),'create my_cool_indicator with: (viz_type:"bar",indicator_name: "Number of blocks");\n')),Object(r.b)("p",null,"If the species is not created as a sub-species of ",Object(r.b)("inlineCode",{parentName:"p"},"cityio_numeric_indicator"),", the indicator will not update. "),Object(r.b)("h1",{id:"running-gama-on-a-server-with-ssh-access"},"Running GAMA on a server with ssh access"),Object(r.b)("p",null,"We highly recommend using a docker container to run GAMA on a headless server. This will take care of compatibility issues between platforms. "),Object(r.b)("p",null,"First, pull the image from dockerhub. This step only needs to be performed once per server. We will be using ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://hub.docker.com/r/gamaplatform/gama"}),"this image"),"."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"> docker pull gamaplatform/gama\n")),Object(r.b)("p",null,"Second, we will build the ",Object(r.b)("inlineCode",{parentName:"p"},"xml")," file with the model meta parameters. You will only need to do this once for each model. From your repo (the folder that contains models, results, etc), run:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),'> docker run --rm -v "$(pwd)":/usr/lib/gama/headless/my_model gamaplatform/gama -xml CityScopeHeadless my_model/models/cityIO.gaml my_model/headless/myHeadlessModel.xml\n')),Object(r.b)("p",null,"This creates a file called ",Object(r.b)("inlineCode",{parentName:"p"},"myHeadlessModel.xml")," in your ",Object(r.b)("inlineCode",{parentName:"p"},"headless")," folder. If you know how to edit this file, feel free to modify it now. For more information about this file, check the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://gama-platform.github.io/wiki/Headless"}),"documentation"),"."),Object(r.b)("p",null,"Finally, we will run this model inside a container. This final step is what you will repeat everytime you modify your model. Run the following command, again from your model director:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),'> docker run --rm -v "$(pwd)":/usr/lib/gama/headless/my_model gamaplatform/gama my_model/headless/myHeadlessModel.xml my_model/results/\n')),Object(r.b)("h1",{id:"examples"},"Examples"),Object(r.b)("p",null,"Agents that randomly move on road network.\n1) Pull road network from OSM\n2) Place agents in network and make them move randomly."))}d.isMDXComponent=!0},84:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return m}));var a=n(0),i=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=i.a.createContext({}),d=function(e){var t=i.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},p=function(e){var t=d(e.components);return i.a.createElement(s.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},u=i.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,o=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),p=d(n),u=a,m=p["".concat(o,".").concat(u)]||p[u]||b[u]||r;return n?i.a.createElement(m,c(c({ref:t},s),{},{components:n})):i.a.createElement(m,c({ref:t},s))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=u;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:a,o[1]=c;for(var s=2;s<r;s++)o[s]=n[s];return i.a.createElement.apply(null,o)}return i.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"}}]);