<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.64">
<title data-react-helmet="true">Examples | Here We Build CityScope</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Examples | Here We Build CityScope"><meta data-react-helmet="true" name="description" content="Examples"><meta data-react-helmet="true" property="og:description" content="Examples"><meta data-react-helmet="true" property="og:url" content="https://cityscope.media.mit.edu/modules/Brix/Examples/Examples"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://cityscope.media.mit.edu/modules/Brix/Examples/Examples"><link rel="stylesheet" href="/styles.7e2856af.css">
<link rel="preload" href="/styles.2685ca2c.js" as="script">
<link rel="preload" href="/runtime~main.616b1c32.js" as="script">
<link rel="preload" href="/main.7747b8d9.js" as="script">
<link rel="preload" href="/1.7a123139.js" as="script">
<link rel="preload" href="/2.13c23208.js" as="script">
<link rel="preload" href="/29.925a41e5.js" as="script">
<link rel="preload" href="/935f2afb.59a88dc1.js" as="script">
<link rel="preload" href="/17896441.135413ed.js" as="script">
<link rel="preload" href="/9f8aa808.385400eb.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/ML_logo.png" alt="Logo"><strong class="navbar__title">MIT CityScope</strong></a><a class="navbar__item navbar__link" href="/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/CityScope" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link" src="img/">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">üåû</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/ML_logo.png" alt="Logo"><strong class="navbar__title">MIT CityScope</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/">Docs</a></li><li class="menu__list-item"><a href="https://github.com/CityScope" target="_blank" rel="noopener noreferrer" class="menu__link" src="img/">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Examples</h1></header><div class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="examples"></a>Examples<a aria-hidden="true" tabindex="-1" class="hash-link" href="#examples" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="short-examples"></a>Short examples<a aria-hidden="true" tabindex="-1" class="hash-link" href="#short-examples" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="numeric-indicator-diversity"></a>Numeric indicator: diversity<a aria-hidden="true" tabindex="-1" class="hash-link" href="#numeric-indicator-diversity" title="Direct link to heading">#</a></h3><p>Indicators are built as subclasses of the :class‚Äùbrix.Indicator class, with three functions that need to be defined: <code>brix.Indicator.setup()</code>, <code>brix.Indicator.load_module()</code>, and <code>brix.Indicator.return_indicator()</code>. The function <code>brix.Indicator.setup()</code> acts like an <strong>init</strong>. It can take any argument and runs when the object is instantiated. The function <code>brix.Indicator.load_module()</code> is also run when the indicator in initialized, but it cannot take any arguments. Any inputs needed to run <code>brix.Indicator.load_module()</code> should be passed to <code>brix.Indicator.setup()</code> and defined as class attributes. The function <code>brix.Indicator.return_indicator()</code> is the only required one and should take in a geogrid_data object (returned from <code>brix.Handler.get_geogrid_data()</code> or from <code>brix.Indicator.get_geogrid_data()</code>) and return the value of the indicator either as a number, a dictionary, or a list of dictionaries/numbers. Sometimes, the indicator requires geographic information from the table to calculate it. To get geographic information from the table, set the property <code>brix.Indicator.requires_geometry</code> to True (see Noise heatmap as an example).</p><p>The following example implements a diversity-of-land-use indicator</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Indicator</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Handler</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">from numpy import log</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">from collections import Counter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class Diversity(Indicator):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        def setup(self):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                self.name = &#x27;Entropy&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        def load_module(self):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                pass</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        def return_indicator(self, geogrid_data):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                uses = [cell[&#x27;land_use&#x27;] for cell in geogrid_data]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                uses = [use for use in uses if use != &#x27;None&#x27;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                frequencies = Counter(uses)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                total = sum(frequencies.values(), 0.0)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                entropy = 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                for key in frequencies:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        p = frequencies[key]/total</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        entropy += -p*log(p)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                return entropy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">div = Diversity()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">H = Handler(&#x27;dungeonmaster&#x27;, quietly=False)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">H.add_indicator(div)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">H.listen()</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="composite-indicator-average"></a>Composite indicator: average<a aria-hidden="true" tabindex="-1" class="hash-link" href="#composite-indicator-average" title="Direct link to heading">#</a></h3><p>In some settings, it might be useful to aggregate different indicators to get a average feel of what the neighborhood looks like. For this use case, brix provides a simplified CompositeIndicator class that only needs an aggregation function.</p><p>Let‚Äôs create an indicator that averages Innovation Potential, Mobility Inmpact, and Economic Impact. We use the <code>brix.CompositeIndicator</code> class for this. This class takes an aggregate function as input. This function should take the result of <code>brix.Handler.get_indicator_values()</code> as input and returns a number. If you want to have more control over what the <code>brix.CompositeIndicator</code> does you can always extend the class.</p><p>Here is the simplest example that averages the values of three indicators:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Handler, CompositeIndicator</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">from brix.examples import RandomIndicator</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def innovation_average(indicator_values):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    avg = (indicator_values[&#x27;Innovation Potential&#x27;]+indicator_values[&#x27;Mobility Impact&#x27;]+indicator_values[&#x27;Economic Impact&#x27;])/3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return avg</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">H = Handler(&#x27;dungeonmaster&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">R = RandomIndicator()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">avg_I = CompositeIndicator(innovation_average,name=&#x27;Composite&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">H.add_indicators([R,avg_I])</span></div></div></div></div></div><p>In some cases, the aggregation function is too simple to write it again. In the example before, you can also pass it a pre-existing function, such as np.mean, making sure that you select the indicators that will be passed as input, by their name.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Handler, CompositeIndicator</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">from brix.examples import RandomIndicator</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import numpy as np</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">H = Handler(&#x27;dungeonmaster&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">R = RandomIndicator()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">avg_I = CompositeIndicator(np.mean,selected_indicators=[&#x27;Innovation Potential&#x27;,&#x27;Mobility Impact&#x27;,&#x27;Economic Impact&#x27;],name=&#x27;Composite&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">H.add_indicators([R,avg_I])</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="heatmap-indicator"></a>Heatmap indicator<a aria-hidden="true" tabindex="-1" class="hash-link" href="#heatmap-indicator" title="Direct link to heading">#</a></h3><p>The same class can be used to define a heatmap or accessiblity indicator, as opposed to a numeric indicator. First, set the class property <code>brix.Indicator.indicator_type</code> equal to heatmap or to access. This will flag the indicator as a heatmap and will tell the Handler class what to do with it.
Second, make sure that the <code>brix.Indicator.return_indicator()</code> function returns a list of features or a geojson.
The example below shows an indicator that returns noise for every point in the center of a grid cell. Because this indicator needs the coordinates of table to return the geojson, it sets the property <code>brix.Indicator.requires_geometry</code> to True.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Indicator</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class Noise(Indicator):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&#x27;&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Example of Noise heatmap indicator for points centered in each grid cell.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Note that this class requires the geometry of the table as input, which is why it sets:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        requires_geometry = True</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        in the setup.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&#x27;&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        def setup(self):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                self.indicator_type = &#x27;heatmap&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                self.requires_geometry = True</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        def load_module(self):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                pass</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        def return_indicator(self, geogrid_data):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                features = []</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                for cell in geogrid_data:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        feature = {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        lat,lon = zip(*cell[&#x27;geometry&#x27;][&#x27;coordinates&#x27;][0])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        lat,lon = mean(lat),mean(lon)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        feature[&#x27;geometry&#x27;] = {&#x27;coordinates&#x27;: [lat,lon],&#x27;type&#x27;: &#x27;Point&#x27;}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        feature[&#x27;properties&#x27;] = {self.name:random()}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        features.append(feature)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                out = {&#x27;type&#x27;:&#x27;FeatureCollection&#x27;,&#x27;features&#x27;:features}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                return out</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="multiple-tables-simultaneously"></a>Multiple tables simultaneously<a aria-hidden="true" tabindex="-1" class="hash-link" href="#multiple-tables-simultaneously" title="Direct link to heading">#</a></h3><p>The following examples instantiates three <code>brix.Handler</code> objects for three different tables (dungeonA, dungeonB, and dungeonC) and adds a diversity of land use indicator to each. It then runs <code>brix.Handler.listen()</code> for each table in its own separate thread.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Handler</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">from brix.examples import Diversity, RandomIndicator</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">table_list = [&#x27;dungeona&#x27;,&#x27;dungeonb&#x27;,&#x27;dungeonc&#x27;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">handler_list = []</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">for table_name in table_list:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        H = Handler(table_name)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        div = Diversity()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        rand = RandomIndicator()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        H.add_indicators([div,rand])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        handler_list.append(H)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">for h in handler_list:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        h.listen()</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="hybrid-indicator"></a>Hybrid indicator<a aria-hidden="true" tabindex="-1" class="hash-link" href="#hybrid-indicator" title="Direct link to heading">#</a></h3><p>For more complex uses cases, where a module runs a big simulation and wants to show both a heatmap and a numeric indicator, you can use a hybrid indicator. To start, set:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">self.indicator_type = &#x27;hybrid&#x27;</span></div></div></div></div></div><p>If you set your indicator as hybrid you need to define a numeric and a heatmap part. The following example generates a heatmap with noise and the average noise as a numeric indicator.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Indicator</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">from numpy import mean</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import random</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class HybridNoise(Indicator):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        def setup(self):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                self.indicator_type = &#x27;hybrid&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                self.name = &#x27;noise&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                self.requires_geometry = True</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                self.mynoise = None</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        def return_indicator_heatmap(self, geogrid_data):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                features = []</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                for cell in geogrid_data:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        feature = {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        lat,lon = zip(*cell[&#x27;geometry&#x27;][&#x27;coordinates&#x27;][0])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        lat,lon = mean(lat),mean(lon)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        feature[&#x27;geometry&#x27;] = {&#x27;coordinates&#x27;: [lat,lon],&#x27;type&#x27;: &#x27;Point&#x27;}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        feature[&#x27;properties&#x27;] = {self.name:random.random()}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        features.append(feature)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                self.mynoise = features</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                out = {&#x27;type&#x27;:&#x27;FeatureCollection&#x27;,&#x27;features&#x27;:features}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                return out</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        def return_indicator_numeric(self, geogrid_data):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                mean_noise = mean([cell[&#x27;properties&#x27;][self.name] for cell in self.mynoise])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                return mean_noise</span></div></div></div></div></div><p>By default, brix will run the heatmap indicator first, followed by the numeric indicator. If you need more control over how these functions interact with each other, you can always re-define the return_indicator function. If you choose to do so, make sure that it returns a dictionary with two keys (‚Äòheatmap‚Äô and ‚Äònumeric‚Äô):</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{&#x27;heatmap&#x27;: heatmap_values, &#x27;numeric&#x27;: numeric_values}</span></div></div></div></div></div><p>In the previous example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">def return_indicator(self, geogrid_data):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        out = {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        out[&#x27;heatmap&#x27;] = self.return_indicator_heatmap(geogrid_data)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        out[&#x27;numeric&#x27;] = self.return_indicator_numeric(geogrid_data)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return out</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="step-by-step-examples"></a>Step by step examples<a aria-hidden="true" tabindex="-1" class="hash-link" href="#step-by-step-examples" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="diversity-of-land-use-indicator---step-by-step"></a>Diversity of land-use indicator - step by step<a aria-hidden="true" tabindex="-1" class="hash-link" href="#diversity-of-land-use-indicator---step-by-step" title="Direct link to heading">#</a></h3><p>As an example, we‚Äôll build a diversity of land use indicator for the test table. The process is the same for any table, provided that it has a GEOGRID variable. Indicators are built as subclasses of the <code>brix.Indicator</code> class, with three functions that need to be defined: <code>brix.Indicator.setup()</code>, <code>brix.Indicator.load_module()</code>, and <code>brix.Indicator.return_indicator()</code>. The function <code>brix.Indicator.setup()</code> acts like an <strong>init</strong>. It can take any argument and runs when the object is instantiated. The function <code>brix.Indicator.load_module()</code> is also run when the indicator in initialized, but it cannot take any arguments. Any inputs needed to run <code>brix.Indicator.load_module()</code> should be passed to <code>brix.Indicator.setup()</code> and defined as class attributes. The function <code>brix.Indicator.return_indicator()</code> is the only required one and should take in a geogrid_data object (returned from <code>brix.Handler.get_geogrid_data()</code> or from <code>brix.Indicator.get_geogrid_data()</code>) and return the value of the indicator either as a number, a dictionary, or a list of dictionaries/numbers.</p><p>To start developing the diversity indicator, you can use the Handler class to get the <code>geogrid_data</code> that is an input of the <code>brix.Indicator.return_indicator()</code> function.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Handler</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">H = Handler(&#x27;dungeonmaster&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">geogrid_data = H.geogrid_data()</span></div></div></div></div></div><p>The returned <code>geogrid_data</code> object depends on the table, but for dungeonmaster it looks like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;color&#x27;: [0, 0, 0, 0],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;height&#x27;: 0.1,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;id&#x27;: 0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;interactive&#x27;: True,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;land_use&#x27;: &#x27;None&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;name&#x27;: &#x27;empty&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;tui_id&#x27;: None</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;color&#x27;: [247, 94, 133, 180],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;height&#x27;: [0, 80],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;id&#x27;: 1,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;interactive&#x27;: True,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;land_use&#x27;: &#x27;PD&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;name&#x27;: &#x27;Office Tower&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;old_color&#x27;: [133, 94, 247, 180],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;old_height&#x27;: [0, 10],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;tui_id&#x27;: None</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;color&#x27;: [0, 0, 0, 0],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;height&#x27;: 0.1,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;id&#x27;: 2,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;interactive&#x27;: True,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;land_use&#x27;: &#x27;None&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;name&#x27;: &#x27;empty&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;tui_id&#x27;: None</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">]</span></div></div></div></div></div><p>We build the diversity indicator by delecting the <code>land_use</code> variable in each cell and calculating the Shannon Entropy for this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">from numpy import log</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">from collections import Counter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">uses = [cell[&#x27;land_use&#x27;] for cell in geogrid_data]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">uses = [use for use in uses if use != &#x27;None&#x27;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">frequencies = Counter(uses)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">total = sum(frequencies.values(), 0.0)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">entropy = 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">for key in frequencies:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        p = frequencies[key]/total</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        entropy += -p*log(p)</span></div></div></div></div></div><p>Now, we wrap this calculation in the <code>brix.Indicator.return_indicator()</code> in a Diversity class that inherits the properties from the <code>brix.Indicator</code> class:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Indicator</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">from numpy import log</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">from collections import Counter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class Diversity(Indicator):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        def setup(self):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                self.name = &#x27;Entropy&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        def load_module(self):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                pass</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        def return_indicator(self, geogrid_data):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                uses = [cell[&#x27;land_use&#x27;] for cell in geogrid_data]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                uses = [use for use in uses if use != &#x27;None&#x27;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                frequencies = Counter(uses)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                total = sum(frequencies.values(), 0.0)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                entropy = 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                for key in frequencies:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        p = frequencies[key]/total</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        entropy += -p*log(p)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                return entropy</span></div></div></div></div></div><p>Because this indicator is very simple, it does not need any parameters or data to calculate the value, which is why the <code>load_module</code> function is empty. The <code>setup</code> function defines the properties of the module, which in this case is just the name.</p><p>Finally, we run the indicator by instantiating the new class and passing it to a Handler object:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Handler</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">div = Diversity()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">H = Handler(&#x27;dungeonmaster&#x27;, quietly=False)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">H.add_indicator(div)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">H.listen()</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="composite-indicator--step-by-step-tutorial"></a>Composite indicator ‚Äì step by step tutorial<a aria-hidden="true" tabindex="-1" class="hash-link" href="#composite-indicator--step-by-step-tutorial" title="Direct link to heading">#</a></h3><p>Let‚Äôs create an indicator that averages Innovation Potential, Mobility Inmpact, and Economic Impact.
First, we load the RandomIndicator and pass it to a Handler.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Handler, CompositeIndicator</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">from brix.examples import RandomIndicator</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">H = Handler(&#x27;dungeonmaster&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">R = RandomIndicator()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">H.add_indicator(R)</span></div></div></div></div></div><p>To develop the aggregate function, we use the <code>brix.Handler.get_indicator_values</code> function from the handler class. We need to make sure our aggregate function works with that the Handler is returning:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">indicator_values = H.get_indicator_values()</span></div></div></div></div></div><p>In this case, the <code>indicator_values</code> is a dictionary with the following elements:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;Social Wellbeing&#x27;: 0.9302328967423512,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;Environmental Impact&#x27;: 0.8229183561962108,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;Mobility Impact&#x27;: 0.3880460148817071,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;Economic Impact&#x27;: 0.13782084927373295,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;Innovation Potential&#x27;: 0.8913823890081203</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>We do not need to use all of the values returned by the Handler for our indicator.</p><p>Next, we write our simple average function that takes <code>indicator_values</code> as input and returns a value, and pass it as an argument to the <code>brix.CompositeIndicator</code> class constructor.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">def innovation_average(indicator_values):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        avg = (indicator_values[&#x27;Innovation Potential&#x27;]+indicator_values[&#x27;Mobility Impact&#x27;]+indicator_values[&#x27;Economic Impact&#x27;])/3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return avg</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">avg_I = CompositeIndicator(innovation_average,name=&#x27;Composite&#x27;)</span></div></div></div></div></div><p>To make sure it is running, we can test it as usual:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">avg_I.return_indicator(indicator_values)</span></div></div></div></div></div><p>We finally add it to the Handler:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">H.add_indicator(avg_I)</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="heatmap-indicator--step-by-step-tutorial"></a>Heatmap indicator ‚Äì step by step tutorial<a aria-hidden="true" tabindex="-1" class="hash-link" href="#heatmap-indicator--step-by-step-tutorial" title="Direct link to heading">#</a></h3><p>This section will show you step by step how to build a proximity to parks indicator.</p><p>Let‚Äôs start by setting up a simple subclass of the Indicator class, give it a name, and set it as a <code>heatmap</code> indicator:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Indicator</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class ProximityIndicator(Indicator):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        def setup(self):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                self.name = &#x27;Parks&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                self.indicator_type = &#x27;heatmap&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        def return_indicator(self, geogrid_data):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                pass</span></div></div></div></div></div><p>Next, we link it to the table. This step is only for building the indicator as we use a <code>brix.Handler</code> object when deploying it.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">P = ProximityIndicator()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">P.link_table(&#x27;dungeonmaster&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">P.get_geogrid_data()</span></div></div></div></div></div><p>When running <code>brix.Indicator.get_geogrid_data()</code> we see that every cell has a <code>name</code> property and some cells are classified as <code>Park</code>. You‚Äôll also notice that by default, when building a <code>heatmap</code> indicator, <code>geogrid_data</code> returns the geometries. You can change this behavior by setting <code>self.requires_geometry=False</code> in your <code>setup</code>.</p><p>Next, we define the <code>return_indicator</code> function. For debugging and testing you can define this function as stand alone function before adding it as a method to the ProximityIndicator. Some useful functions for debugging are <code>brix.Indicator.get_geogrid_data()</code> and <code>brix.Indicator.get_table_properties()</code> that will list general properties of the linked table.</p><p>In this example, the proximity indicator is defined as one over the distance to the closest park. When the cell is a park, we define the proximity as 1/(half size of each cell) to avoid dividing by zero.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">import numpy as np</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">from geopy.distance import distance as geodistance # Function for distance between coordinates</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">def return_indicator(self,geogrid_data):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        parks = [cell for cell in geogrid_data if cell[&#x27;name&#x27;]==&#x27;Park&#x27;] # Find all parks</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        parks_locations = [np.mean(cell[&#x27;geometry&#x27;][&#x27;coordinates&#x27;][0],0) for cell in parks] # Filter out the center of all park locations (locations are lon,lat format)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        features = []</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        for cell in geogrid_data: # Calculate a value for the indicator for each cell</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                cell_coords = np.mean(cell[&#x27;geometry&#x27;][&#x27;coordinates&#x27;][0],0) # Calculate center of cell (locations are lon,lat format)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                if cell[&#x27;name&#x27;]==&#x27;Park&#x27;: # If cell is park, set distance to zero</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        park_distance = 25 # This is based on half the cell size (see P.get_table_properties())</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                else:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        distances = [geodistance(cell_coords[::-1],park_loc[::-1]).m for park_loc in parks_locations] # Distance between cell and each park. Notice that we reverse the coordinates for geodistance.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        park_distance = min(distances) # get distance to closest park</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                proximity = 1/park_distance</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                scaled_proximity = (proximity-0.002)/(0.03-0.002) # this ensures the indicator is between zero and one</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                # Generate feature with points (lon,lat format) and properties.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                feature = {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                feature[&#x27;geometry&#x27;] = {&#x27;coordinates&#x27;: list(cell_coords),&#x27;type&#x27;: &#x27;Point&#x27;} # cell_coords should be a list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                feature[&#x27;properties&#x27;] = {self.name: scaled_proximity} # Use the indicator name to tag the value</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                features.append(feature) # add to features list for export</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        out = {&#x27;type&#x27;:&#x27;FeatureCollection&#x27;,&#x27;features&#x27;:features}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return out</span></div></div></div></div></div><p>You can test your function by running: <code>return_indicator(P,geogrid_data)</code>.</p><p>Finally, let‚Äôs put it all together:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Indicator</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import numpy as np</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">from geopy.distance import distance as geodistance</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class ProximityIndicator(Indicator):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        def setup(self):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                self.name = &#x27;Parks&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                self.indicator_type = &#x27;heatmap&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        def return_indicator(self,geogrid_data):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                parks = [cell for cell in geogrid_data if cell[&#x27;name&#x27;]==&#x27;Park&#x27;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                parks_locations = [np.mean(cell[&#x27;geometry&#x27;][&#x27;coordinates&#x27;][0],0) for cell in parks]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                features = []</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                for cell in geogrid_data:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        cell_coords = list(np.mean(cell[&#x27;geometry&#x27;][&#x27;coordinates&#x27;][0],0) )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        if cell[&#x27;name&#x27;]==&#x27;Park&#x27;:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                park_distance = 45</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        else:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                distances = [geodistance(cell_coords[::-1],park_loc[::-1]).m for park_loc in parks_locations]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                park_distance = min(distances)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        proximity = 1/park_distance</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        scaled_proximity = (proximity-0.002)/(0.03-0.002)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        feature = {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        feature[&#x27;geometry&#x27;] = {&#x27;coordinates&#x27;: cell_coords,&#x27;type&#x27;: &#x27;Point&#x27;}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        feature[&#x27;properties&#x27;] = {self.name: scaled_proximity}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        features.append(feature)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                out = {&#x27;type&#x27;:&#x27;FeatureCollection&#x27;,&#x27;features&#x27;:features}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                return out</span></div></div></div></div></div><p>And to deploy it:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Handler</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">H = Handler(&#x27;dungeonmaster&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">P = ProximityIndicator()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">H.add_indicator(P)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">H.listen()</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="static-heatmap-indicator"></a>Static-Heatmap indicator<a aria-hidden="true" tabindex="-1" class="hash-link" href="#static-heatmap-indicator" title="Direct link to heading">#</a></h3><p>The <code>brix.Indicator</code> class provides a flexible way to define any type of indicator. In some cases, a simple approach is needed. Let‚Äôs assume we want to build a simple heatmap indicator that just visualizes a given shapefile, and does not react to changes in geogriddata. We can use <code>brix.StaticHeatmap</code> to build that.</p><p>In this example, we will use the number of houses by block in Guadalajara, Mexico. You can download the shapefile from <a href="https://www.inegi.org.mx/contenidos/masiva/indicadores/inv/14_Manzanas_INV2016_shp.zip" target="_blank" rel="noopener noreferrer">HERE</a>. We will not be using our trusted dungeonmaster table, as it does not overlap with the data. Instead we will use jalisco.</p><p>The first step will be to ‚Äúgriddify‚Äù our shapefile, meaning we will transform it from polygons to sampling points. Please note that you can use any sampling method for this, and that the sampling points do not need to match the grid. To make things easier, we have provided <code>brix.griddify()</code>, which uses the centroids of the grid to sample the values of the heatmap.</p><p>We start by loading the shapefile and removing the missing values:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">import geopandas as gpd</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">shapefile = gpd.read_file(&#x27;/Users/username/Downloads/14_Manzanas_INV2016_shp/14_Manzanas_INV2016.shp&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">shapefile = shapefile[shapefile[&#x27;VIVTOT&#x27;]!=&#x27;N.D.&#x27;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">shapefile[&#x27;VIVTOT&#x27;] = shapefile[&#x27;VIVTOT&#x27;].astype(float)</span></div></div></div></div></div><p>Since the VIVTOT column that we are interested in visualizing has a skewed distribution, we will log-transform it.</p><p>::</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">import numpy as np</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">shapefile[‚Äòlog_VIVTOT‚Äô] = np.log(shapefile[‚ÄòVIVTOT‚Äô]+1)</span></div></div></div></div></div><p>Next, we load a table and use its grid to sample the heatmap.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Handler</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">H = Handler(&#x27;jalisco&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">geogrid_data = H.get_geogrid_data()</span></div></div></div></div></div><p>The next step is to use the grid to sample the values of the heatmap. We will use the log_VIVTOT column, and save the resulting heatmap to a file so we can load it later. We will also remove the missing values.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import griddify</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">heatmap = griddify(geogrid_data,shapefile,columns=[&#x27;log_VIVTOT&#x27;])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">heatmap = heatmap[~heatmap[&#x27;log_VIVTOT&#x27;].isna()]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">heatmap.to_file(&#x27;/Users/username/Downloads/14_Manzanas_INV2016_shp/HEATMAP.shp&#x27;)</span></div></div></div></div></div><p>This shapefile is a table of points and their properties. To build your indicator you can either load the file and pass it to the :class:brix.StaticHeatmap` constructor, or have the constructor load it for you.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import StaticHeatmap</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N = StaticHeatmap(&#x27;/Users/username/Downloads/14_Manzanas_INV2016_shp/HEATMAP.shp&#x27;,columns=[&#x27;log_VIVTOT&#x27;])</span></div></div></div></div></div><p>Finally, we add it to a Handler class and check the update package:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">H = Handler(&#x27;jalisco&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">H.add_indicator(N)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">H.update_package()</span></div></div></div></div></div><p>To sum up, to preprocess the data:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">import geopandas as gpd</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import numpy as np</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Handler</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import griddify</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">shapefile = gpd.read_file(&#x27;/Users/username/Downloads/14_Manzanas_INV2016_shp/14_Manzanas_INV2016.shp&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">shapefile = shapefile[shapefile[&#x27;VIVTOT&#x27;]!=&#x27;N.D.&#x27;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">shapefile[&#x27;VIVTOT&#x27;] = shapefile[&#x27;VIVTOT&#x27;].astype(float)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">shapefile[&#x27;log_VIVTOT&#x27;] = np.log(shapefile[&#x27;VIVTOT&#x27;]+1)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">H = Handler(&#x27;jalisco&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">geogrid_data = H.get_geogrid_data()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">heatmap = griddify(geogrid_data,shapefile,columns=[&#x27;log_VIVTOT&#x27;],buffer_percent=3)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">heatmap = heatmap[~heatmap[&#x27;log_VIVTOT&#x27;].isna()]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">heatmap.to_file(&#x27;/Users/username/Downloads/14_Manzanas_INV2016_shp/HEATMAP.shp&#x27;)</span></div></div></div></div></div><p>And once the heatmap file has been saved, all you need to do deploy the indicator is:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Handler, StaticHeatmap</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N = StaticHeatmap(&#x27;/Users/username/Downloads/14_Manzanas_INV2016_shp/HEATMAP.shp&#x27;,columns=[&#x27;log_VIVTOT&#x27;])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">H = Handler(&#x27;jalisco&#x27;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">H.add_indicator(N)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">H.listen()</span></div></div></div></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/CityScope/cityscope.github.io/blob/new_docsite/docsite/docs/modules/Brix/Examples/Examples.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#short-examples" class="table-of-contents__link">Short examples</a><ul><li><a href="#numeric-indicator-diversity" class="table-of-contents__link">Numeric indicator: diversity</a></li><li><a href="#composite-indicator-average" class="table-of-contents__link">Composite indicator: average</a></li><li><a href="#heatmap-indicator" class="table-of-contents__link">Heatmap indicator</a></li><li><a href="#multiple-tables-simultaneously" class="table-of-contents__link">Multiple tables simultaneously</a></li><li><a href="#hybrid-indicator" class="table-of-contents__link">Hybrid indicator</a></li></ul></li><li><a href="#step-by-step-examples" class="table-of-contents__link">Step by step examples</a><ul><li><a href="#diversity-of-land-use-indicator---step-by-step" class="table-of-contents__link">Diversity of land-use indicator - step by step</a></li><li><a href="#composite-indicator--step-by-step-tutorial" class="table-of-contents__link">Composite indicator ‚Äì step by step tutorial</a></li><li><a href="#heatmap-indicator--step-by-step-tutorial" class="table-of-contents__link">Heatmap indicator ‚Äì step by step tutorial</a></li><li><a href="#static-heatmap-indicator" class="table-of-contents__link">Static-Heatmap indicator</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="text--center"><div class="margin-bottom--sm"><a href="https://github.com/CityScope" target="_blank" rel="noopener noreferrer" class="footerLogoLink_1zJy"><img class="footer__logo" alt="Logo" src="/img/ML_logo_sml.png"></a></div><div>Copyright ¬© 2021 CityScope, MIT City Science</div></div></div></footer></div>
<script src="/styles.2685ca2c.js"></script>
<script src="/runtime~main.616b1c32.js"></script>
<script src="/main.7747b8d9.js"></script>
<script src="/1.7a123139.js"></script>
<script src="/2.13c23208.js"></script>
<script src="/29.925a41e5.js"></script>
<script src="/935f2afb.59a88dc1.js"></script>
<script src="/17896441.135413ed.js"></script>
<script src="/9f8aa808.385400eb.js"></script>
</body>
</html>