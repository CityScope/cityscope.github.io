<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-archive/brix/Examples/Examples" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.1">
<title data-rh="true">Examples | Here We Build CityScope</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://cityscope.media.mit.edu/archive/brix/Examples/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Examples | Here We Build CityScope"><meta data-rh="true" name="description" content="Short examples"><meta data-rh="true" property="og:description" content="Short examples"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://cityscope.media.mit.edu/archive/brix/Examples/"><link data-rh="true" rel="alternate" href="https://cityscope.media.mit.edu/archive/brix/Examples/" hreflang="en"><link data-rh="true" rel="alternate" href="https://cityscope.media.mit.edu/archive/brix/Examples/" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.a961cfe0.css">
<script src="/assets/js/runtime~main.3bfd9d4e.js" defer="defer"></script>
<script src="/assets/js/main.1f802b69.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/ML_logo.png" alt="Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/ML_logo.png" alt="Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">MIT CityScope</b></a></div><div class="navbar__items navbar__items--right"><a href="https://cityscope.media.mit.edu/CS_cityscopeJS" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link" src="img/">CityScopeJS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/CityScope" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link" src="img/">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/">CityScope</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/">Introduction</a><button aria-label="Expand sidebar category &#x27;Introduction&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/category/cityscopejs">CityScopeJS</a><button aria-label="Expand sidebar category &#x27;CityScopeJS&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/category/modules">Modules</a><button aria-label="Expand sidebar category &#x27;Modules&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/category/cityio">CityIO</a><button aria-label="Expand sidebar category &#x27;CityIO&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/category/tangible-user-interfaces">Tangible User Interfaces</a><button aria-label="Expand sidebar category &#x27;Tangible User Interfaces&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/category/archive">Archive</a><button aria-label="Collapse sidebar category &#x27;Archive&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/archive/h3/">[Archive] H3 Grid</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/archive/brix/">[Archive] The brix library</a><button aria-label="Collapse sidebar category &#x27;[Archive] The brix library&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/archive/brix/Examples/">Examples</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/archive/brix/GAMA">GAMA</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/archive/brix/Tutorial/">Tutorials</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/archive/cityio/">[Archive] CityIO</a><button aria-label="Expand sidebar category &#x27;[Archive] CityIO&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">CityScope</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/category/archive"><span itemprop="name">Archive</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/archive/brix/"><span itemprop="name">[Archive] The brix library</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Examples</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Examples</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="short-examples">Short examples<a href="#short-examples" class="hash-link" aria-label="Direct link to Short examples" title="Direct link to Short examples">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="numeric-indicator-diversity">Numeric indicator: diversity<a href="#numeric-indicator-diversity" class="hash-link" aria-label="Direct link to Numeric indicator: diversity" title="Direct link to Numeric indicator: diversity">​</a></h3>
<p>Indicators are built as subclasses of the <!-- -->:class<!-- -->”brix.Indicator class, with three functions that need to be defined: <code>brix.Indicator.setup()</code>, <code>brix.Indicator.load_module()</code>, and <code>brix.Indicator.return_indicator()</code>. The function <code>brix.Indicator.setup()</code> acts like an <strong>init</strong>. It can take any argument and runs when the object is instantiated. The function <code>brix.Indicator.load_module()</code> is also run when the indicator in initialized, but it cannot take any arguments. Any inputs needed to run <code>brix.Indicator.load_module()</code> should be passed to <code>brix.Indicator.setup()</code> and defined as class attributes. The function <code>brix.Indicator.return_indicator()</code> is the only required one and should take in a geogrid_data object (returned from <code>brix.Handler.get_geogrid_data()</code> or from <code>brix.Indicator.get_geogrid_data()</code>) and return the value of the indicator either as a number, a dictionary, or a list of dictionaries/numbers. Sometimes, the indicator requires geographic information from the table to calculate it. To get geographic information from the table, set the property <code>brix.Indicator.requires_geometry</code> to True (see Noise heatmap as an example).</p>
<p>The following example implements a diversity-of-land-use indicator</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Indicator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Handler</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from numpy import log</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from collections import Counter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class Diversity(Indicator):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        def setup(self):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                self.name = &#x27;Entropy&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        def load_module(self):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                pass</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        def return_indicator(self, geogrid_data):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                uses = [cell[&#x27;land_use&#x27;] for cell in geogrid_data]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                uses = [use for use in uses if use != &#x27;None&#x27;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                frequencies = Counter(uses)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                total = sum(frequencies.values(), 0.0)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                entropy = 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                for key in frequencies:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        p = frequencies[key]/total</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        entropy += -p*log(p)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                return entropy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">div = Diversity()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">H = Handler(&#x27;dungeonmaster&#x27;, quietly=False)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">H.add_indicator(div)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">H.listen()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="composite-indicator-average">Composite indicator: average<a href="#composite-indicator-average" class="hash-link" aria-label="Direct link to Composite indicator: average" title="Direct link to Composite indicator: average">​</a></h3>
<p>In some settings, it might be useful to aggregate different indicators to get a average feel of what the neighborhood looks like. For this use case, brix provides a simplified CompositeIndicator class that only needs an aggregation function.</p>
<p>Let’s create an indicator that averages Innovation Potential, Mobility Inmpact, and Economic Impact. We use the <code>brix.CompositeIndicator</code> class for this. This class takes an aggregate function as input. This function should take the result of <code>brix.Handler.get_indicator_values()</code> as input and returns a number. If you want to have more control over what the <code>brix.CompositeIndicator</code> does you can always extend the class.</p>
<p>Here is the simplest example that averages the values of three indicators:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Handler, CompositeIndicator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from brix.examples import RandomIndicator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">def innovation_average(indicator_values):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    avg = (indicator_values[&#x27;Innovation Potential&#x27;]+indicator_values[&#x27;Mobility Impact&#x27;]+indicator_values[&#x27;Economic Impact&#x27;])/3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return avg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">H = Handler(&#x27;dungeonmaster&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">R = RandomIndicator()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">avg_I = CompositeIndicator(innovation_average,name=&#x27;Composite&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">H.add_indicators([R,avg_I])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In some cases, the aggregation function is too simple to write it again. In the example before, you can also pass it a pre-existing function, such as np.mean, making sure that you select the indicators that will be passed as input, by their name.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Handler, CompositeIndicator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from brix.examples import RandomIndicator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import numpy as np</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">H = Handler(&#x27;dungeonmaster&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">R = RandomIndicator()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">avg_I = CompositeIndicator(np.mean,selected_indicators=[&#x27;Innovation Potential&#x27;,&#x27;Mobility Impact&#x27;,&#x27;Economic Impact&#x27;],name=&#x27;Composite&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">H.add_indicators([R,avg_I])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="heatmap-indicator">Heatmap indicator<a href="#heatmap-indicator" class="hash-link" aria-label="Direct link to Heatmap indicator" title="Direct link to Heatmap indicator">​</a></h3>
<p>The same class can be used to define a heatmap or accessiblity indicator, as opposed to a numeric indicator. First, set the class property <code>brix.Indicator.indicator_type</code> equal to heatmap or to access. This will flag the indicator as a heatmap and will tell the Handler class what to do with it.
Second, make sure that the <code>brix.Indicator.return_indicator()</code> function returns a list of features or a geojson.
The example below shows an indicator that returns noise for every point in the center of a grid cell. Because this indicator needs the coordinates of table to return the geojson, it sets the property <code>brix.Indicator.requires_geometry</code> to True.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Indicator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class Noise(Indicator):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Example of Noise heatmap indicator for points centered in each grid cell.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Note that this class requires the geometry of the table as input, which is why it sets:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        requires_geometry = True</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        in the setup.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        def setup(self):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                self.indicator_type = &#x27;heatmap&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                self.requires_geometry = True</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        def load_module(self):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                pass</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        def return_indicator(self, geogrid_data):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                features = []</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                for cell in geogrid_data:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        feature = {}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        lat,lon = zip(*cell[&#x27;geometry&#x27;][&#x27;coordinates&#x27;][0])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        lat,lon = mean(lat),mean(lon)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        feature[&#x27;geometry&#x27;] = {&#x27;coordinates&#x27;: [lat,lon],&#x27;type&#x27;: &#x27;Point&#x27;}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        feature[&#x27;properties&#x27;] = {self.name:random()}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        features.append(feature)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                out = {&#x27;type&#x27;:&#x27;FeatureCollection&#x27;,&#x27;features&#x27;:features}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                return out</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="textual-indicator">Textual indicator<a href="#textual-indicator" class="hash-link" aria-label="Direct link to Textual indicator" title="Direct link to Textual indicator">​</a></h3>
<p>The example below annotates two randomly chosen cells with <code>yes!</code> and <code>no!</code>.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Indicator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import random</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class RandomFlag(Indicator):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Example of textual indicator that annotates two random cells.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        def setup(self):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                self.indicator_type = &#x27;textual&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                self.requires_geometry = True</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                self.name = &#x27;Yes/No&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        def return_indicator(self, geogrid_data):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                cells = random.sample(geogrid_data,2)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                out = [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        {&#x27;id&#x27;:cells[0][&#x27;id&#x27;],&#x27;info&#x27;:&#x27;yes!&#x27;},</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        {&#x27;id&#x27;:cells[1][&#x27;id&#x27;],&#x27;info&#x27;:&#x27;no!&#x27;},</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                ]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                return out</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="multiple-tables-simultaneously">Multiple tables simultaneously<a href="#multiple-tables-simultaneously" class="hash-link" aria-label="Direct link to Multiple tables simultaneously" title="Direct link to Multiple tables simultaneously">​</a></h3>
<p>The following examples instantiates three <code>brix.Handler</code> objects for three different tables (dungeonA, dungeonB, and dungeonC) and adds a diversity of land use indicator to each. It then runs <code>brix.Handler.listen()</code> for each table in its own separate thread.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Handler</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from brix.examples import Diversity, RandomIndicator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">table_list = [&#x27;dungeona&#x27;,&#x27;dungeonb&#x27;,&#x27;dungeonc&#x27;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">handler_list = []</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">for table_name in table_list:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        H = Handler(table_name)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        div = Diversity()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        rand = RandomIndicator()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        H.add_indicators([div,rand])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        handler_list.append(H)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">for h in handler_list:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        h.listen()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="hybrid-indicator">Hybrid indicator<a href="#hybrid-indicator" class="hash-link" aria-label="Direct link to Hybrid indicator" title="Direct link to Hybrid indicator">​</a></h3>
<p>For more complex uses cases, where a module runs a big simulation and wants to show both a heatmap and a numeric indicator, you can use a hybrid indicator. To start, set:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">self.indicator_type = &#x27;hybrid&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you set your indicator as hybrid you need to define a numeric and a heatmap part. The following example generates a heatmap with noise and the average noise as a numeric indicator.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Indicator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from numpy import mean</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import random</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class HybridNoise(Indicator):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        def setup(self):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                self.indicator_type = &#x27;hybrid&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                self.name = &#x27;noise&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                self.requires_geometry = True</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                self.mynoise = None</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        def return_indicator_heatmap(self, geogrid_data):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                features = []</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                for cell in geogrid_data:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        feature = {}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        lat,lon = zip(*cell[&#x27;geometry&#x27;][&#x27;coordinates&#x27;][0])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        lat,lon = mean(lat),mean(lon)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        feature[&#x27;geometry&#x27;] = {&#x27;coordinates&#x27;: [lat,lon],&#x27;type&#x27;: &#x27;Point&#x27;}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        feature[&#x27;properties&#x27;] = {self.name:random.random()}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        features.append(feature)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                self.mynoise = features</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                out = {&#x27;type&#x27;:&#x27;FeatureCollection&#x27;,&#x27;features&#x27;:features}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                return out</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        def return_indicator_numeric(self, geogrid_data):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                mean_noise = mean([cell[&#x27;properties&#x27;][self.name] for cell in self.mynoise])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                return mean_noise</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>By default, brix will run the heatmap indicator first, followed by the numeric indicator. If you need more control over how these functions interact with each other, you can always re-define the return_indicator function. If you choose to do so, make sure that it returns a dictionary with two keys (‘heatmap’ and ‘numeric’):</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{&#x27;heatmap&#x27;: heatmap_values, &#x27;numeric&#x27;: numeric_values}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the previous example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">def return_indicator(self, geogrid_data):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        out = {}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        out[&#x27;heatmap&#x27;] = self.return_indicator_heatmap(geogrid_data)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        out[&#x27;numeric&#x27;] = self.return_indicator_numeric(geogrid_data)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return out</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-by-step-examples">Step by step examples<a href="#step-by-step-examples" class="hash-link" aria-label="Direct link to Step by step examples" title="Direct link to Step by step examples">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="diversity-of-land-use-indicator---step-by-step">Diversity of land-use indicator - step by step<a href="#diversity-of-land-use-indicator---step-by-step" class="hash-link" aria-label="Direct link to Diversity of land-use indicator - step by step" title="Direct link to Diversity of land-use indicator - step by step">​</a></h3>
<p>As an example, we’ll build a diversity of land use indicator for the test table. The process is the same for any table, provided that it has a GEOGRID variable. Indicators are built as subclasses of the <code>brix.Indicator</code> class, with three functions that need to be defined: <code>brix.Indicator.setup()</code>, <code>brix.Indicator.load_module()</code>, and <code>brix.Indicator.return_indicator()</code>. The function <code>brix.Indicator.setup()</code> acts like an <strong>init</strong>. It can take any argument and runs when the object is instantiated. The function <code>brix.Indicator.load_module()</code> is also run when the indicator in initialized, but it cannot take any arguments. Any inputs needed to run <code>brix.Indicator.load_module()</code> should be passed to <code>brix.Indicator.setup()</code> and defined as class attributes. The function <code>brix.Indicator.return_indicator()</code> is the only required one and should take in a geogrid_data object (returned from <code>brix.Handler.get_geogrid_data()</code> or from <code>brix.Indicator.get_geogrid_data()</code>) and return the value of the indicator either as a number, a dictionary, or a list of dictionaries/numbers.</p>
<p>To start developing the diversity indicator, you can use the Handler class to get the <code>geogrid_data</code> that is an input of the <code>brix.Indicator.return_indicator()</code> function.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Handler</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">H = Handler(&#x27;dungeonmaster&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">geogrid_data = H.geogrid_data()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The returned <code>geogrid_data</code> object depends on the table, but for dungeonmaster it looks like this:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;color&#x27;: [0, 0, 0, 0],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;height&#x27;: 0.1,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;id&#x27;: 0,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;interactive&#x27;: True,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;land_use&#x27;: &#x27;None&#x27;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;name&#x27;: &#x27;empty&#x27;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;tui_id&#x27;: None</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;color&#x27;: [247, 94, 133, 180],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;height&#x27;: [0, 80],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;id&#x27;: 1,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;interactive&#x27;: True,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;land_use&#x27;: &#x27;PD&#x27;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;name&#x27;: &#x27;Office Tower&#x27;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;old_color&#x27;: [133, 94, 247, 180],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;old_height&#x27;: [0, 10],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;tui_id&#x27;: None</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;color&#x27;: [0, 0, 0, 0],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;height&#x27;: 0.1,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;id&#x27;: 2,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;interactive&#x27;: True,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;land_use&#x27;: &#x27;None&#x27;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;name&#x27;: &#x27;empty&#x27;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &#x27;tui_id&#x27;: None</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We build the diversity indicator by delecting the <code>land_use</code> variable in each cell and calculating the Shannon Entropy for this:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from numpy import log</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from collections import Counter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">uses = [cell[&#x27;land_use&#x27;] for cell in geogrid_data]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">uses = [use for use in uses if use != &#x27;None&#x27;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">frequencies = Counter(uses)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">total = sum(frequencies.values(), 0.0)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">entropy = 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">for key in frequencies:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        p = frequencies[key]/total</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        entropy += -p*log(p)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now, we wrap this calculation in the <code>brix.Indicator.return_indicator()</code> in a Diversity class that inherits the properties from the <code>brix.Indicator</code> class:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Indicator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from numpy import log</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from collections import Counter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class Diversity(Indicator):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        def setup(self):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                self.name = &#x27;Entropy&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        def load_module(self):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                pass</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        def return_indicator(self, geogrid_data):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                uses = [cell[&#x27;land_use&#x27;] for cell in geogrid_data]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                uses = [use for use in uses if use != &#x27;None&#x27;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                frequencies = Counter(uses)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                total = sum(frequencies.values(), 0.0)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                entropy = 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                for key in frequencies:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        p = frequencies[key]/total</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        entropy += -p*log(p)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                return entropy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Because this indicator is very simple, it does not need any parameters or data to calculate the value, which is why the <code>load_module</code> function is empty. The <code>setup</code> function defines the properties of the module, which in this case is just the name.</p>
<p>Finally, we run the indicator by instantiating the new class and passing it to a Handler object:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Handler</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">div = Diversity()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">H = Handler(&#x27;dungeonmaster&#x27;, quietly=False)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">H.add_indicator(div)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">H.listen()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="composite-indicator--step-by-step-tutorial">Composite indicator – step by step tutorial<a href="#composite-indicator--step-by-step-tutorial" class="hash-link" aria-label="Direct link to Composite indicator – step by step tutorial" title="Direct link to Composite indicator – step by step tutorial">​</a></h3>
<p>Let’s create an indicator that averages Innovation Potential, Mobility Inmpact, and Economic Impact.
First, we load the RandomIndicator and pass it to a Handler.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Handler, CompositeIndicator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from brix.examples import RandomIndicator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">H = Handler(&#x27;dungeonmaster&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">R = RandomIndicator()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">H.add_indicator(R)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To develop the aggregate function, we use the <code>brix.Handler.get_indicator_values</code> function from the handler class. We need to make sure our aggregate function works with that the Handler is returning:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">indicator_values = H.get_indicator_values()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this case, the <code>indicator_values</code> is a dictionary with the following elements:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;Social Wellbeing&#x27;: 0.9302328967423512,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;Environmental Impact&#x27;: 0.8229183561962108,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;Mobility Impact&#x27;: 0.3880460148817071,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;Economic Impact&#x27;: 0.13782084927373295,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;Innovation Potential&#x27;: 0.8913823890081203</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We do not need to use all of the values returned by the Handler for our indicator.</p>
<p>Next, we write our simple average function that takes <code>indicator_values</code> as input and returns a value, and pass it as an argument to the <code>brix.CompositeIndicator</code> class constructor.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">def innovation_average(indicator_values):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        avg = (indicator_values[&#x27;Innovation Potential&#x27;]+indicator_values[&#x27;Mobility Impact&#x27;]+indicator_values[&#x27;Economic Impact&#x27;])/3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return avg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">avg_I = CompositeIndicator(innovation_average,name=&#x27;Composite&#x27;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To make sure it is running, we can test it as usual:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">avg_I.return_indicator(indicator_values)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We finally add it to the Handler:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">H.add_indicator(avg_I)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="heatmap-indicator--step-by-step-tutorial">Heatmap indicator – step by step tutorial<a href="#heatmap-indicator--step-by-step-tutorial" class="hash-link" aria-label="Direct link to Heatmap indicator – step by step tutorial" title="Direct link to Heatmap indicator – step by step tutorial">​</a></h3>
<p>This section will show you step by step how to build a proximity to parks indicator.</p>
<p>Let’s start by setting up a simple subclass of the Indicator class, give it a name, and set it as a <code>heatmap</code> indicator:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Indicator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class ProximityIndicator(Indicator):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        def setup(self):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                self.name = &#x27;Parks&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                self.indicator_type = &#x27;heatmap&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        def return_indicator(self, geogrid_data):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                pass</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Next, we link it to the table. This step is only for building the indicator as we use a <code>brix.Handler</code> object when deploying it.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">P = ProximityIndicator()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">P.link_table(&#x27;dungeonmaster&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">P.get_geogrid_data()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When running <code>brix.Indicator.get_geogrid_data()</code> we see that every cell has a <code>name</code> property and some cells are classified as <code>Park</code>. You’ll also notice that by default, when building a <code>heatmap</code> indicator, <code>geogrid_data</code> returns the geometries. You can change this behavior by setting <code>self.requires_geometry=False</code> in your <code>setup</code>.</p>
<p>Next, we define the <code>return_indicator</code> function. For debugging and testing you can define this function as stand alone function before adding it as a method to the ProximityIndicator. Some useful functions for debugging are <code>brix.Indicator.get_geogrid_data()</code> and <code>brix.Indicator.get_table_properties()</code> that will list general properties of the linked table.</p>
<p>In this example, the proximity indicator is defined as one over the distance to the closest park. When the cell is a park, we define the proximity as 1/(half size of each cell) to avoid dividing by zero.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">import numpy as np</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from geopy.distance import distance as geodistance # Function for distance between coordinates</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">def return_indicator(self,geogrid_data):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        parks = [cell for cell in geogrid_data if cell[&#x27;name&#x27;]==&#x27;Park&#x27;] # Find all parks</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        parks_locations = [np.mean(cell[&#x27;geometry&#x27;][&#x27;coordinates&#x27;][0],0) for cell in parks] # Filter out the center of all park locations (locations are lon,lat format)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        features = []</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        for cell in geogrid_data: # Calculate a value for the indicator for each cell</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                cell_coords = np.mean(cell[&#x27;geometry&#x27;][&#x27;coordinates&#x27;][0],0) # Calculate center of cell (locations are lon,lat format)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                if cell[&#x27;name&#x27;]==&#x27;Park&#x27;: # If cell is park, set distance to zero</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        park_distance = 25 # This is based on half the cell size (see P.get_table_properties())</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                else:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        distances = [geodistance(cell_coords[::-1],park_loc[::-1]).m for park_loc in parks_locations] # Distance between cell and each park. Notice that we reverse the coordinates for geodistance.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        park_distance = min(distances) # get distance to closest park</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                proximity = 1/park_distance</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                scaled_proximity = (proximity-0.002)/(0.03-0.002) # this ensures the indicator is between zero and one</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                # Generate feature with points (lon,lat format) and properties.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                feature = {}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                feature[&#x27;geometry&#x27;] = {&#x27;coordinates&#x27;: list(cell_coords),&#x27;type&#x27;: &#x27;Point&#x27;} # cell_coords should be a list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                feature[&#x27;properties&#x27;] = {self.name: scaled_proximity} # Use the indicator name to tag the value</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                features.append(feature) # add to features list for export</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        out = {&#x27;type&#x27;:&#x27;FeatureCollection&#x27;,&#x27;features&#x27;:features}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return out</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can test your function by running: <code>return_indicator(P,geogrid_data)</code>.</p>
<p>Finally, let’s put it all together:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Indicator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import numpy as np</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from geopy.distance import distance as geodistance</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class ProximityIndicator(Indicator):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        def setup(self):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                self.name = &#x27;Parks&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                self.indicator_type = &#x27;heatmap&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        def return_indicator(self,geogrid_data):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                parks = [cell for cell in geogrid_data if cell[&#x27;name&#x27;]==&#x27;Park&#x27;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                parks_locations = [np.mean(cell[&#x27;geometry&#x27;][&#x27;coordinates&#x27;][0],0) for cell in parks]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                features = []</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                for cell in geogrid_data:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        cell_coords = list(np.mean(cell[&#x27;geometry&#x27;][&#x27;coordinates&#x27;][0],0) )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        if cell[&#x27;name&#x27;]==&#x27;Park&#x27;:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                park_distance = 45</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        else:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                distances = [geodistance(cell_coords[::-1],park_loc[::-1]).m for park_loc in parks_locations]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                park_distance = min(distances)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        proximity = 1/park_distance</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        scaled_proximity = (proximity-0.002)/(0.03-0.002)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        feature = {}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        feature[&#x27;geometry&#x27;] = {&#x27;coordinates&#x27;: cell_coords,&#x27;type&#x27;: &#x27;Point&#x27;}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        feature[&#x27;properties&#x27;] = {self.name: scaled_proximity}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        features.append(feature)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                out = {&#x27;type&#x27;:&#x27;FeatureCollection&#x27;,&#x27;features&#x27;:features}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                return out</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>And to deploy it:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Handler</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">H = Handler(&#x27;dungeonmaster&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">P = ProximityIndicator()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">H.add_indicator(P)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">H.listen()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="static-heatmap-indicator">Static-Heatmap indicator<a href="#static-heatmap-indicator" class="hash-link" aria-label="Direct link to Static-Heatmap indicator" title="Direct link to Static-Heatmap indicator">​</a></h3>
<p>The <code>brix.Indicator</code> class provides a flexible way to define any type of indicator. In some cases, a simple approach is needed. Let’s assume we want to build a simple heatmap indicator that just visualizes a given shapefile, and does not react to changes in geogriddata. We can use <code>brix.StaticHeatmap</code> to build that.</p>
<p>In this example, we will use the number of houses by block in Guadalajara, Mexico. You can download the shapefile from <a href="https://www.inegi.org.mx/contenidos/masiva/indicadores/inv/14_Manzanas_INV2016_shp.zip" target="_blank" rel="noopener noreferrer">HERE</a>. We will not be using our trusted dungeonmaster table, as it does not overlap with the data. Instead we will use jalisco.</p>
<p>The first step will be to “griddify” our shapefile, meaning we will transform it from polygons to sampling points. Please note that you can use any sampling method for this, and that the sampling points do not need to match the grid. To make things easier, we have provided <code>brix.griddify()</code>, which uses the centroids of the grid to sample the values of the heatmap.</p>
<p>We start by loading the shapefile and removing the missing values:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">import geopandas as gpd</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">shapefile = gpd.read_file(&#x27;/Users/username/Downloads/14_Manzanas_INV2016_shp/14_Manzanas_INV2016.shp&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">shapefile = shapefile[shapefile[&#x27;VIVTOT&#x27;]!=&#x27;N.D.&#x27;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">shapefile[&#x27;VIVTOT&#x27;] = shapefile[&#x27;VIVTOT&#x27;].astype(float)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Since the VIVTOT column that we are interested in visualizing has a skewed distribution, we will log-transform it.</p>
<p>::</p>
<p>import numpy as np
shapefile[‘log_VIVTOT’] = np.log(shapefile[‘VIVTOT’]+1)</p>
<p>Next, we load a table and use its grid to sample the heatmap.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Handler</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">H = Handler(&#x27;jalisco&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">geogrid_data = H.get_geogrid_data()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The next step is to use the grid to sample the values of the heatmap. We will use the log_VIVTOT column, and save the resulting heatmap to a file so we can load it later. We will also remove the missing values.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import griddify</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">heatmap = griddify(geogrid_data,shapefile,columns=[&#x27;log_VIVTOT&#x27;])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">heatmap = heatmap[~heatmap[&#x27;log_VIVTOT&#x27;].isna()]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">heatmap.to_file(&#x27;/Users/username/Downloads/14_Manzanas_INV2016_shp/HEATMAP.shp&#x27;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This shapefile is a table of points and their properties. To build your indicator you can either load the file and pass it to the :class<!-- -->:brix<!-- -->.StaticHeatmap` constructor, or have the constructor load it for you.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import StaticHeatmap</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">N = StaticHeatmap(&#x27;/Users/username/Downloads/14_Manzanas_INV2016_shp/HEATMAP.shp&#x27;,columns=[&#x27;log_VIVTOT&#x27;])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Finally, we add it to a Handler class and check the update package:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">H = Handler(&#x27;jalisco&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">H.add_indicator(N)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">H.update_package()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To sum up, to preprocess the data:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">import geopandas as gpd</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import numpy as np</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Handler</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import griddify</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">shapefile = gpd.read_file(&#x27;/Users/username/Downloads/14_Manzanas_INV2016_shp/14_Manzanas_INV2016.shp&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">shapefile = shapefile[shapefile[&#x27;VIVTOT&#x27;]!=&#x27;N.D.&#x27;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">shapefile[&#x27;VIVTOT&#x27;] = shapefile[&#x27;VIVTOT&#x27;].astype(float)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">shapefile[&#x27;log_VIVTOT&#x27;] = np.log(shapefile[&#x27;VIVTOT&#x27;]+1)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">H = Handler(&#x27;jalisco&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">geogrid_data = H.get_geogrid_data()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">heatmap = griddify(geogrid_data,shapefile,columns=[&#x27;log_VIVTOT&#x27;],buffer_percent=3)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">heatmap = heatmap[~heatmap[&#x27;log_VIVTOT&#x27;].isna()]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">heatmap.to_file(&#x27;/Users/username/Downloads/14_Manzanas_INV2016_shp/HEATMAP.shp&#x27;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>And once the heatmap file has been saved, all you need to do deploy the indicator is:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from brix import Handler, StaticHeatmap</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">N = StaticHeatmap(&#x27;/Users/username/Downloads/14_Manzanas_INV2016_shp/HEATMAP.shp&#x27;,columns=[&#x27;log_VIVTOT&#x27;])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">H = Handler(&#x27;jalisco&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">H.add_indicator(N)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">H.listen()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/CityScope/cityscope.github.io/docs/archive/brix/Examples/Examples.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/archive/brix/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">[Archive] The brix library</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/archive/brix/GAMA"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">GAMA</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#short-examples" class="table-of-contents__link toc-highlight">Short examples</a><ul><li><a href="#numeric-indicator-diversity" class="table-of-contents__link toc-highlight">Numeric indicator: diversity</a></li><li><a href="#composite-indicator-average" class="table-of-contents__link toc-highlight">Composite indicator: average</a></li><li><a href="#heatmap-indicator" class="table-of-contents__link toc-highlight">Heatmap indicator</a></li><li><a href="#textual-indicator" class="table-of-contents__link toc-highlight">Textual indicator</a></li><li><a href="#multiple-tables-simultaneously" class="table-of-contents__link toc-highlight">Multiple tables simultaneously</a></li><li><a href="#hybrid-indicator" class="table-of-contents__link toc-highlight">Hybrid indicator</a></li></ul></li><li><a href="#step-by-step-examples" class="table-of-contents__link toc-highlight">Step by step examples</a><ul><li><a href="#diversity-of-land-use-indicator---step-by-step" class="table-of-contents__link toc-highlight">Diversity of land-use indicator - step by step</a></li><li><a href="#composite-indicator--step-by-step-tutorial" class="table-of-contents__link toc-highlight">Composite indicator – step by step tutorial</a></li><li><a href="#heatmap-indicator--step-by-step-tutorial" class="table-of-contents__link toc-highlight">Heatmap indicator – step by step tutorial</a></li><li><a href="#static-heatmap-indicator" class="table-of-contents__link toc-highlight">Static-Heatmap indicator</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://github.com/CityScope" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/img/ML_logo_sml.png" alt="Logo" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/ML_logo_sml.png" alt="Logo" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"></a></div><div class="footer__copyright">CityScope, MIT City Science 2024</div></div></div></footer></div>
</body>
</html>